{% load staticfiles %}

<script>
    (function() {
        $('#search-items').keyup(function(event) {
            var q = $(this).val()

            $.ajax({
                type: 'GET',
                url: '{% url "items:search_items_view" %}',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'q': q,
                    'shopping_list_pk': '{{ shopping_list.pk }}',
                },
                success: function(data) {
                    $('.search-result ul').empty()

                    if (q) {
                        var submit_button = $('<button>').attr('class', 'form-control-feedback fui-plus');

                        var csrf_token = $('<input>');
                        csrf_token.attr('type', 'hidden')
                            .attr('name', 'csrfmiddlewaretoken')
                            .attr('value', '{{ csrf_token }}');
                            
                        var item_name = $('<input>');
                        item_name.attr('type', 'hidden')
                            .attr('name', 'item-name')
                            .attr('value', q);

                        var result = $('<form>')
                            .attr('action', '{% url "lists:add_items_to_list_view" pk=shopping_list.pk %}')
                            .attr('method', 'POST')
                            .append(item_name)
                            .append(csrf_token)
                            .append(q)
                            .append(submit_button);

                        $('.search-result ul').prepend($('<li>').append(result));
                    }

                    $('.search-result ul').append(data);

                },
                error: function(data) {
                    console.log('Ajax Error');
                }
            });
        });
    })();
</script>
